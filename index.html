<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Absensi Karyawan</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Chart.js untuk grafik -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Menggunakan font Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            box-sizing: border-box;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* slate-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* slate-400 */
        }
        
        /* Gaya dari Model Baru */
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .heatmap-cell {
            width: 25px;
            height: 25px;
            border-radius: 4px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .heatmap-cell:hover {
            transform: scale(1.2);
            z-index: 10;
        }
        
        /* Status untuk Heatmap (disesuaikan dengan data GAS) */
        .status-hadir { background-color: #10b981; } /* Hijau - Tepat Waktu */
        .status-telat { background-color: #f59e0b; } /* Kuning - Terlambat */
        .status-absen { background-color: #ef4444; } /* Merah - Absen */
        .status-kosong { background-color: #e5e7eb; } /* Abu-abu - Tidak ada data */

        /* Gaya untuk status loading (dari kode lama) */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-size: 1.2rem;
            color: #333;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-full">

    <!-- Tambahkan overlay loading -->
    <div id="loadingOverlay">
        <p>Memuat data dashboard...</p>
    </div>

    <div class="container mx-auto px-6 py-8">
        
        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Dashboard Absensi Karyawan</h1>
            <p class="text-gray-600" id="dashboard-subtitle">Ringkasan kepatuhan dan tren kehadiran karyawan.</p>
        </header>

        <!-- Filter Kontrol (Diambil dari kode lama, di-styling sedikit) -->
        <div class="mb-8 p-6 bg-white rounded-xl shadow-lg">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Filter Tanggal Mulai -->
                <div>
                    <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Mulai</label>
                    <input type="date" id="startDate" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
                <!-- Filter Tanggal Selesai -->
                <div>
                    <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Selesai</label>
                    <input type="date" id="endDate" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
                <!-- Filter Departemen -->
                <div>
                    <label for="filterDepartemen" class="block text-sm font-medium text-gray-700 mb-1">Departemen</label>
                    <select id="filterDepartemen" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="Semua">Semua Departemen</option>
                    </select>
                </div>
                <!-- Filter Karyawan -->
                <div>
                    <label for="filterKaryawan" class="block text-sm font-medium text-gray-700 mb-1">Karyawan</label>
                    <select id="filterKaryawan" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="Semua">Semua Karyawan</option>
                    </select>
                </div>
            </div>
            <div class="mt-4 text-right">
                <button id="filterButton" class="bg-blue-600 text-white px-5 py-2 rounded-lg shadow hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50" disabled>
                    Terapkan Filter
                </button>
            </div>
        </div>

        <!-- Papan Skor Utama -->
        <section class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">üìä Papan Skor Utama (Sesuai Filter)</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="metric-card text-white p-6 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm font-medium">Tingkat Kehadiran</p>
                            <p class="text-3xl font-bold" id="kpi-tingkat-kehadiran">0%</p>
                        </div>
                        <div class="text-4xl">üéØ</div>
                    </div>
                </div>
                
                <div class="metric-card text-white p-6 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm font-medium">Total Keterlambatan</p>
                            <p class="text-3xl font-bold" id="kpi-total-terlambat">0</p>
                        </div>
                        <div class="text-4xl">‚è∞</div>
                    </div>
                </div>
                
                <div class="metric-card text-white p-6 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm font-medium">Total Absen</p>
                            <p class="text-3xl font-bold" id="kpi-total-absen">0</p>
                        </div>
                        <div class="text-4xl">üìã</div>
                    </div>
                </div>
                
                <div class="metric-card text-white p-6 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm font-medium">Karyawan Paling Rawan</p>
                            <p class="text-xl font-bold" id="kpi-karyawan-rawan">-</p>
                        </div>
                        <div class="text-4xl">‚ö†Ô∏è</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Grafik Tren -->
        <section class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">üìà Grafik Tren (Sesuai Filter)</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Grafik Batang Keterlambatan -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Tren Keterlambatan Harian</h3>
                    <canvas id="chartKeterlambatan" width="400" height="200"></canvas>
                </div>
                
                <!-- Grafik Donat Komposisi -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Komposisi Kehadiran</h3>
                    <canvas id="chartKomposisi" width="400" height="200"></canvas>
                </div>
            </div>
        </section>

        <!-- Daftar Aksi -->
        <section class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">üéØ Daftar Aksi Prioritas (Sesuai Filter)</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Top 5 Keterlambatan -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="text-yellow-500 mr-2">‚è∞</span>
                        Top 5 Keterlambatan
                    </h3>
                    <div class="space-y-3" id="top-keterlambatan">
                        <p class="text-gray-500 text-center py-4">Tidak ada data.</p>
                    </div>
                </div>
                
                <!-- Top 5 Absensi -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="text-red-500 mr-2">üìã</span>
                        Top 5 Absensi
                    </h3>
                    <div class="space-y-3" id="top-absensi">
                        <p class="text-gray-500 text-center py-4">Tidak ada data.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Peta Panas Kinerja -->
        <section class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">üî• Peta Panas Kinerja (Sesuai Filter)</h2>
            <div class="bg-white p-6 rounded-xl shadow-lg overflow-x-auto">
                <div class="mb-4 flex flex-wrap gap-4 text-sm">
                    <div class="flex items-center">
                        <div class="w-4 h-4 status-hadir rounded mr-2"></div>
                        <span>Hadir Tepat Waktu</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 status-telat rounded mr-2"></div>
                        <span>Terlambat</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 status-absen rounded mr-2"></div>
                        <span>Absen</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 status-kosong rounded mr-2"></div>
                        <span>Tidak Ada Data</span>
                    </div>
                </div>
                <div id="heatmap-container">
                    <p class="text-gray-500 text-center py-4">Terapkan filter untuk melihat Peta Panas.</p>
                </div>
            </div>
        </section>
    </div>

    <script>
        // --- PENGATURAN KONEKSI GAS ---
        // URL Web App Anda telah dimasukkan
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyIgORJuY2bwgv7Q70qDEmSE2EFIiuZ3xBcs7d5lbyAjWABwVzBAjuqapxTU5qQ-n0kAg/exec'; 

        // --- Variabel Global untuk Data ---
        let allLaporanData = [];
        let allKaryawanList = [];
        let allDepartemenList = [];
        const today = new Date();
        const todayISO = formatISODate(today);

        // --- Variabel global untuk Chart ---
        let keterlambatanChartInstance = null;
        let komposisiChartInstance = null;
        
        // --- Fungsi Helper ---
        function formatISODate(date) {
            return date.toISOString().split('T')[0];
        }

        // Helper untuk mendapatkan rentang tanggal
        function getDatesInRange(startDate, endDate) {
            const dates = [];
            let currentDate = new Date(startDate);
            const end = new Date(endDate);
            
            while (currentDate <= end) {
                dates.push(formatISODate(new Date(currentDate)));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            return dates;
        }

        // --- Fungsi Rendering BARU ---

        // Fungsi untuk merender Grafik Keterlambatan Harian (BAR)
        function renderGrafikKeterlambatan(filteredData) {
            const dailyLate = {};
            filteredData.forEach(item => {
                if (item.keterangan && (item.keterangan.includes('Terlambat') || item.keterangan.includes('TELAT'))) {
                    dailyLate[item.tanggal] = (dailyLate[item.tanggal] || 0) + 1;
                }
            });

            // Urutkan berdasarkan tanggal
            const sortedLabels = Object.keys(dailyLate).sort();
            const sortedData = sortedLabels.map(label => dailyLate[label]);

            const ctx = document.getElementById('chartKeterlambatan').getContext('2d');
            if (keterlambatanChartInstance) {
                keterlambatanChartInstance.destroy();
            }
            keterlambatanChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedLabels,
                    datasets: [{
                        label: 'Jumlah Keterlambatan',
                        data: sortedData,
                        backgroundColor: 'rgba(245, 158, 11, 0.8)',
                        borderColor: 'rgba(245, 158, 11, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Fungsi untuk merender Grafik Komposisi (DOUGHNUT)
        function renderGrafikKomposisi(filteredData) {
            let tepatWaktu = 0;
            let terlambat = 0;
            let absen = 0;

            filteredData.forEach(item => {
                if (item.status === 'Absen') {
                    absen++;
                } else if (item.status === 'Hadir') {
                    if (item.keterangan && (item.keterangan.includes('Terlambat') || item.keterangan.includes('TELAT'))) {
                        terlambat++;
                    } else {
                        tepatWaktu++;
                    }
                }
            });

            const ctx = document.getElementById('chartKomposisi').getContext('2d');
            if (komposisiChartInstance) {
                komposisiChartInstance.destroy();
            }
            komposisiChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Tepat Waktu', 'Terlambat', 'Absen'],
                    datasets: [{
                        data: [tepatWaktu, terlambat, absen],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',  // Hijau
                            'rgba(245, 158, 11, 0.8)',  // Kuning
                            'rgba(239, 68, 68, 0.8)'    // Merah
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Fungsi untuk merender Daftar Top 5 (BARU)
        function renderTopList(elementId, data, colorClass) {
            const container = document.getElementById(elementId);
            container.innerHTML = ''; // Kosongkan

            if (!data || data.length === 0) {
                container.innerHTML = `<p class="text-gray-500 text-center py-4">Tidak ada data.</p>`;
                return;
            }

            const bgClass = colorClass === 'yellow' ? 'bg-yellow-50' : 'bg-red-50';
            const textClass = colorClass === 'yellow' ? 'text-yellow-600' : 'text-red-600';
            const iconBgClass = colorClass === 'yellow' ? 'bg-yellow-500' : 'bg-red-500';

            data.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = `flex justify-between items-center p-3 ${bgClass} rounded-lg`;
                div.innerHTML = `
                    <div class="flex items-center">
                        <span class="w-6 h-6 ${iconBgClass} text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">${index + 1}</span>
                        <span class="font-medium">${item.nama}</span>
                    </div>
                    <span class="${textClass} font-bold">${item.jumlah}x</span>
                `;
                container.appendChild(div);
            });
        }

        // Fungsi untuk merender Heatmap (BARU)
        function renderHeatmap(filteredData, karyawanList, startDate, endDate) {
            const container = document.getElementById('heatmap-container');
            container.innerHTML = ''; // Kosongkan

            const dates = getDatesInRange(startDate, endDate);
            if (dates.length === 0 || karyawanList.length === 0) {
                container.innerHTML = `<p class="text-gray-500 text-center py-4">Data tidak cukup untuk Peta Panas.</p>`;
                return;
            }
            
            // Buat Peta (Map) untuk pencarian cepat
            const dataMap = new Map();
            filteredData.forEach(item => {
                const key = item.nama + '_' + item.tanggal;
                let statusClass = 'status-kosong';
                if (item.status === 'Absen') {
                    statusClass = 'status-absen';
                } else if (item.status === 'Hadir') {
                    statusClass = (item.keterangan && (item.keterangan.includes('Terlambat') || item.keterangan.includes('TELAT'))) ? 'status-telat' : 'status-hadir';
                }
                dataMap.set(key, { class: statusClass, title: `${item.nama} - ${item.tanggal}: ${item.keterangan || item.status}` });
            });


            const table = document.createElement('table');
            table.className = 'w-full';

            // Header tanggal
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = '<th class="text-left p-2 font-medium text-gray-700 min-w-32 sticky left-0 bg-white z-10">Karyawan</th>';
            dates.forEach(date => {
                const th = document.createElement('th');
                th.className = 'text-center p-1 text-xs text-gray-600';
                th.textContent = date.substring(8); // Hanya tampilkan tanggal
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            // Baris karyawan
            karyawanList.forEach(k => {
                const row = document.createElement('tr');
                row.className = 'border-t';
                
                const nameCell = document.createElement('td');
                nameCell.className = 'p-2 font-medium text-gray-800 sticky left-0 bg-white z-10';
                nameCell.textContent = k.nama;
                row.appendChild(nameCell);

                dates.forEach(date => {
                    const cell = document.createElement('td');
                    cell.className = 'p-1 text-center';
                    
                    const statusDiv = document.createElement('div');
                    statusDiv.className = 'heatmap-cell mx-auto';

                    const key = k.nama + '_' + date;
                    const data = dataMap.get(key);
                    
                    if (data) {
                        statusDiv.classList.add(data.class);
                        statusDiv.title = data.title;
                    } else {
                        // Cek apakah hari kerja (jika data tidak ada, mungkin hari libur)
                        const dayOfWeek = new Date(date + 'T00:00:00').getDay();
                        if (dayOfWeek === 0 || dayOfWeek === 6) {
                             statusDiv.classList.add('status-kosong');
                             statusDiv.title = `${k.nama} - ${date}: Hari Libur`;
                        } else {
                            // Jika hari kerja tapi tidak ada di map (misal, di luar 30 hari GAS)
                             statusDiv.classList.add('status-kosong');
                             statusDiv.title = `${k.nama} - ${date}: Tidak Ada Data`;
                        }
                    }
                    
                    cell.appendChild(statusDiv);
                    row.appendChild(cell);
                });
                
                table.appendChild(row);
            });

            container.appendChild(table);
        }
        

        // Fungsi utama untuk update dashboard
        function updateDashboard() {
            // 1. Dapatkan nilai filter
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const departemen = document.getElementById('filterDepartemen').value;
            const karyawan = document.getElementById('filterKaryawan').value;
            
            document.getElementById('dashboard-subtitle').textContent = `Menampilkan data dari ${startDate} s/d ${endDate}`;


            // 2. Filter data utama (dari data global)
            let filteredData = allLaporanData.filter(item => {
                const tgl = item.tanggal;
                const isDateInRange = (!startDate || tgl >= startDate) && (!endDate || tgl <= endDate);
                const isDeptMatch = (departemen === 'Semua' || item.departemen === departemen);
                const isKaryawanMatch = (karyawan === 'Semua' || item.nama === karyawan);
                return isDateInRange && isDeptMatch && isKaryawanMatch;
            });
            
            // Filter karyawan list berdasarkan filter departemen
            let filteredKaryawanList = allKaryawanList;
            if (departemen !== 'Semua') {
                filteredKaryawanList = allKaryawanList.filter(k => k.departemen === departemen);
            }
            if (karyawan !== 'Semua') {
                filteredKaryawanList = allKaryawanList.filter(k => k.nama === karyawan);
            }


            // 3. Update KPI
            const totalHadir = filteredData.filter(d => d.status === 'Hadir').length;
            const totalAbsen = filteredData.filter(d => d.status === 'Absen').length;
            const totalTerlambat = filteredData.filter(d => d.keterangan && (d.keterangan.includes('Terlambat') || d.keterangan.includes('TELAT'))).length;
            const totalRecords = filteredData.length; 
            const tingkatKehadiran = totalRecords > 0 ? ((totalHadir / totalRecords) * 100).toFixed(1) : 0;

            document.getElementById('kpi-tingkat-kehadiran').textContent = `${tingkatKehadiran}%`;
            document.getElementById('kpi-total-terlambat').textContent = totalTerlambat;
            document.getElementById('kpi-total-absen').textContent = totalAbsen;

            // Hitung karyawan paling rawan (dari data terfilter)
            const performa = {};
            filteredData.forEach(item => {
                if (!performa[item.nama]) performa[item.nama] = { nama: item.nama, masalah: 0 };
                
                if (item.status === 'Absen' || (item.keterangan && (item.keterangan.includes('Terlambat') || item.keterangan.includes('TELAT')))) {
                    performa[item.nama].masalah++;
                }
            });
            
            const sortedPerforma = Object.values(performa).sort((a, b) => b.masalah - a.masalah);
            const karyawanRawan = sortedPerforma.length > 0 ? sortedPerforma[0].nama : '-';
            document.getElementById('kpi-karyawan-rawan').textContent = karyawanRawan;


            // 4. Update Grafik Tren
            renderGrafikKeterlambatan(filteredData);
            renderGrafikKomposisi(filteredData);

            // 5. Update Daftar Aksi Prioritas
            const topTerlambatData = Object.values(performa).map(k => ({
                nama: k.nama,
                jumlah: filteredData.filter(item => item.nama === k.nama && (item.keterangan && (item.keterangan.includes('Terlambat') || item.keterangan.includes('TELAT')))).length
            })).sort((a, b) => b.jumlah - a.jumlah).filter(k => k.jumlah > 0).slice(0, 5);
            
            const topAbsenData = Object.values(performa).map(k => ({
                nama: k.nama,
                jumlah: filteredData.filter(item => item.nama === k.nama && item.status === 'Absen').length
            })).sort((a, b) => b.jumlah - a.jumlah).filter(k => k.jumlah > 0).slice(0, 5);

            renderTopList('top-keterlambatan', topTerlambatData, 'yellow');
            renderTopList('top-absensi', topAbsenData, 'red');
            
            // 6. Update Peta Panas
            // Catatan: Peta Panas menggunakan filteredKaryawanList agar tidak terlalu ramai
            renderHeatmap(filteredData, filteredKaryawanList, startDate, endDate);
        }

        // Fungsi untuk mengisi filter dropdown
        function populateFilters() {
            const filterDept = document.getElementById('filterDepartemen');
            allDepartemenList.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                filterDept.appendChild(option);
            });

            const filterKaryawan = document.getElementById('filterKaryawan');
            allKaryawanList.forEach(k => {
                const option = document.createElement('option');
                option.value = k.nama;
                option.textContent = k.nama;
                filterKaryawan.appendChild(option);
            });
            
            // Set default tanggal filter (30 hari terakhir dari data)
            // Diperbarui: GAS sekarang MENGIRIM 30 hari terakhir, jadi kita set filter ke 30 hari terakhir juga
            const thirtyDaysAgo = new Date(new Date().setDate(today.getDate() - 30));
            document.getElementById('endDate').value = todayISO;
            document.getElementById('startDate').value = formatISODate(thirtyDaysAgo);
        }

        // --- Fungsi Utama untuk Inisialisasi ---
        async function initDashboard() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const filterButton = document.getElementById('filterButton');
            
            try {
                if (GAS_WEB_APP_URL === 'PASTE_URL_WEB_APP_ANDA_DI_SINI') {
                    loadingOverlay.textContent = 'Error: Harap masukkan URL Web App Google Apps Script di file HTML.';
                    return;
                }

                const response = await fetch(GAS_WEB_APP_URL);
                if (!response.ok) {
                    throw new Error(`Gagal mengambil data: ${response.statusText}`);
                }
                
                const data = await response.json();

                if (data.error) {
                     throw new Error(`Error dari Google Apps Script: ${data.error}`);
                }
                
                // Simpan data ke variabel global
                allLaporanData = data.laporanData;
                allKaryawanList = data.karyawanList;
                allDepartemenList = data.departemenList;

                // Isi filter
                populateFilters();
                
                // Tampilkan data awal
                updateDashboard(); 
                
                // Sembunyikan loading dan aktifkan filter
                loadingOverlay.style.display = 'none';
                filterButton.disabled = false;

            } catch (error) {
                console.error('Error saat inisialisasi dashboard:', error);
                loadingOverlay.textContent = `Error: ${error.message}. Cek konsol (F12) untuk detail.`;
            }
        }


        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            initDashboard(); // Panggil fungsi fetch data
        });

        document.getElementById('filterButton').addEventListener('click', updateDashboard);

    </script>
</body>
</html>

